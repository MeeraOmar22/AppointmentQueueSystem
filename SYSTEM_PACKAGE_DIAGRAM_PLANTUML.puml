@startuml Dental_Clinic_Package_Diagram
!theme plain
skinparam backgroundColor #fafafa
skinparam packageStyle rectangle
skinparam linetype ortho
skinparam shadowing true

title Dental Clinic System - Module Package Diagram\nFunctional Decomposition

' ============================================
' EXTERNAL USERS
' ============================================

actor "Patient User" as patient_actor
actor "Clinic Staff" as staff_actor
actor "System Admin" as admin_actor

' ============================================
' ROOT SYSTEM PACKAGE
' ============================================

package "Dental Clinic Appointment & Queue System" {
    
    ' ============================================
    ' PUBLIC/WEBSITE MODULE
    ' ============================================
    package "1. PUBLIC/WEBSITE MODULE\n[Informational Portal]" #FFE4B5 {
        package "Controllers" {
            class PublicController {
                home()
                about()
                services()
                dentists()
                contact()
                hours()
            }
        }
        
        package "Views" {
            component "home.blade.php"
            component "about.blade.php"
            component "services.blade.php"
            component "dentists.blade.php"
            component "contact.blade.php"
            component "hours.blade.php"
        }
        
        PublicController --> "Views"
    }
    
    ' ============================================
    ' PATIENT FUNCTIONAL MODULE
    ' ============================================
    package "2. PATIENT FUNCTIONAL MODULE\n[Transactional Services]" #E6F2FF {
        package "Controllers" {
            class AppointmentController {
                create()
                store()
                visitStatus()
                trackByCode()
                publicCheckIn()
                checkinForm()
                queueBoard()
                findMyBooking()
            }
            
            class FeedbackController {
                create()
                store()
                thanks()
            }
            
            class ChatbotController {
                index()
                handle()
            }
        }
        
        package "Views" {
            component "book.blade.php"
            component "checkin.blade.php"
            component "track.blade.php"
            component "queue-board.blade.php"
            component "feedback.blade.php"
            component "chat/index.blade.php"
        }
        
        AppointmentController --> "Views"
        FeedbackController --> "Views"
        ChatbotController --> "Views"
    }
    
    ' ============================================
    ' QUEUE & OPERATIONS MODULE (CORE)
    ' ============================================
    package "3. QUEUE & OPERATIONS MODULE\n[Real-Time Optimization Engine]" #E6FFE6 {
        package "API Controllers" {
            class QueueController {
                checkIn()
                getNextPatient()
                updateQueueStatus()
                getQueueStats()
                createWalkIn()
                autoMarkLate()
                autoMarkNoShow()
            }
        }
        
        package "Business Services" {
            class CheckInService {
                checkIn(appointment)
                validateCheckIn(appointment)
                isLate(appointment)
                checkInLate(appointment)
            }
            
            class QueueAssignmentService {
                assignNextPatient()
                startTreatment(queue)
                completeTreatment(queue)
                getEstimatedWaitTime(queue)
                getQueueStats()
                findAvailableRoom()
                findAvailableDentist()
                allRoomsOccupied()
            }
            
            class LateNoShowService {
                markLateAppointments()
                markNoShowAppointments()
                handleDentistUnavailable()
                createWalkIn()
                recoverAppointment()
            }
        }
        
        QueueController --> CheckInService
        QueueController --> QueueAssignmentService
        QueueController --> LateNoShowService
        CheckInService --> QueueAssignmentService
    }
    
    ' ============================================
    ' STAFF/OPERATIONS MODULE
    ' ============================================
    package "4. STAFF/OPERATIONS MODULE\n[Daily Operations Management]" #FFF0E6 {
        package "Appointment Management" {
            class AppointmentController_Staff {
                index()
                create()
                store()
                edit()
                update()
                destroy()
                checkIn()
                storeWalkIn()
                updateQueueStatus()
            }
        }
        
        package "Resource Management" {
            class DentistController {
                index()
                create()
                store()
                edit()
                update()
                destroy()
                updateStatus()
            }
            
            class ServiceController {
                index()
                create()
                store()
                edit()
                update()
                destroy()
            }
            
            class RoomController {
                index()
                create()
                store()
                edit()
                update()
                destroy()
                stats()
            }
            
            class OperatingHourController {
                index()
                create()
                store()
                edit()
                update()
                destroy()
            }
        }
        
        package "Scheduling & Planning" {
            class DentistScheduleController {
                index()
                update()
                calendar()
                events()
            }
            
            class DentistLeaveController {
                store()
                destroy()
            }
            
            class CalendarController {
                index()
                events()
            }
        }
        
        package "Management Tools" {
            class QuickEditController {
                index()
                updateDentistStatus()
                updateServiceStatus()
                updateOperatingHour()
                updateStaffVisibility()
                storeStaff()
                destroyStaff()
            }
            
            class PastController {
                index()
                restoreDentist()
                forceDeleteDentist()
                restoreStaff()
                forceDeleteStaff()
            }
            
            class ActivityLogController {
                index()
            }
            
            class FeedbackController_Staff {
                index()
                show()
            }
        }
        
        package "Views" {
            component "appointments.blade.php"
            component "dentists/*.blade.php"
            component "services/*.blade.php"
            component "rooms/*.blade.php"
            component "calendar/*.blade.php"
            component "activity-logs.blade.php"
            component "quick-edit.blade.php"
            component "past.blade.php"
        }
        
        AppointmentController_Staff --> "Views"
        DentistController --> "Views"
        ServiceController --> "Views"
        RoomController --> "Views"
        CalendarController --> "Views"
    }
    
    ' ============================================
    ' ADMIN MODULE
    ' ============================================
    package "5. ADMIN MODULE\n[System Management & Configuration]" #F0E6FF {
        package "Controllers" {
            class HomeController {
                index()
            }
            
            class DeveloperController {
                login()
                authenticate()
                dashboard()
                apiTest()
                logout()
            }
            
            class AdminPastController {
                index()
                restoreDentist()
                forceDeleteDentist()
                restoreStaff()
                forceDeleteStaff()
            }
        }
        
        package "Views" {
            component "home.blade.php"
            component "developer/*.blade.php"
            component "past.blade.php"
        }
        
        HomeController --> "Views"
        DeveloperController --> "Views"
        AdminPastController --> "Views"
    }
    
    ' ============================================
    ' CROSS-CUTTING SERVICES
    ' ============================================
    package "CROSS-CUTTING SERVICES\n[Shared Infrastructure]" #F5F5F5 {
        package "Audit & Logging" {
            class ActivityLogger {
                log(action, modelType, modelId, description, oldValues, newValues)
            }
        }
        
        package "Communication" {
            class WhatsAppSender {
                sendAppointmentConfirmation(appointment)
            }
            
            class AppointmentConfirmationMail {
                __construct(appointment)
                build()
            }
        }
        
        package "Security" {
            class RoleMiddleware {
                handle(request, next, role)
            }
            
            class AuthControllers {
                LoginController
                RegisterController
                ForgotPasswordController
                ResetPasswordController
            }
        }
        
        package "Authentication & Authorization" {
            class User {
                role: string
                public_visible: boolean
                +hasMany(ActivityLog)
            }
        }
    }
    
    ' ============================================
    ' DATA LAYER - MODELS
    ' ============================================
    package "DATA LAYER - ELOQUENT MODELS" #E8E8E8 {
        class Appointment {
            patient_name
            patient_phone
            status
            appointment_date
            appointment_time
            +belongsTo(Service)
            +belongsTo(Dentist)
            +hasOne(Queue)
            +hasMany(Feedback)
        }
        
        class Queue {
            queue_status: enum
            check_in_time
            start_treatment_time
            end_treatment_time
            +belongsTo(Appointment)
            +belongsTo(Dentist)
            +belongsTo(Room)
        }
        
        class Dentist {
            name
            status
            +hasMany(DentistSchedule)
            +hasMany(DentistLeave)
            +hasMany(Queue)
        }
        
        class DentistSchedule {
            day_of_week
            start_time
            end_time
            +belongsTo(Dentist)
        }
        
        class DentistLeave {
            start_date
            end_date
            leave_type
            +belongsTo(Dentist)
        }
        
        class Service {
            name
            estimated_duration
            +hasMany(Appointment)
        }
        
        class Room {
            name
            status
            +hasMany(Queue)
        }
        
        class OperatingHour {
            day_of_week
            start_time
            end_time
        }
        
        class Feedback {
            rating
            comment
            +belongsTo(Appointment)
            +belongsTo(Dentist)
        }
        
        class ActivityLog {
            action
            model_type
            old_values: json
            new_values: json
            ip_address
            +belongsTo(User)
        }
    }
}

' ============================================
' DATABASE
' ============================================

database "Database\n(SQLite/MySQL)" as DB {
    table "appointments"
    table "queues"
    table "dentists"
    table "dentist_schedules"
    table "dentist_leaves"
    table "services"
    table "rooms"
    table "operating_hours"
    table "users"
    table "feedback"
    table "activity_logs"
}

' ============================================
' EXTERNAL SYSTEMS
' ============================================

cloud "EXTERNAL INTEGRATIONS" #FFE8E8 {
    component "Email Service\n(SMTP/Mailgun/SES)"
    component "SMS/WhatsApp Provider\n(Twilio/AWS SNS)"
    component "Queue Worker\n(Database Driver)"
}

' ============================================
' USER INTERACTIONS
' ============================================

patient_actor --> "1. PUBLIC/WEBSITE MODULE" : visits clinic website
patient_actor --> "2. PATIENT FUNCTIONAL MODULE" : books appointment\nchecks in\ntracks status

staff_actor --> "4. STAFF/OPERATIONS MODULE" : manages daily operations\nviews queue\nmanages resources

admin_actor --> "5. ADMIN MODULE" : system configuration\ndata recovery\naudit logs

' ============================================
' MODULE INTERACTIONS
' ============================================

"2. PATIENT FUNCTIONAL MODULE" --> "3. QUEUE & OPERATIONS MODULE" : submits check-in
"4. STAFF/OPERATIONS MODULE" --> "3. QUEUE & OPERATIONS MODULE" : manages queue\nprocess appointments
"3. QUEUE & OPERATIONS MODULE" --> "4. STAFF/OPERATIONS MODULE" : queue updates

' ============================================
' DATA DEPENDENCIES
' ============================================

"2. PATIENT FUNCTIONAL MODULE" --> Appointment
"2. PATIENT FUNCTIONAL MODULE" --> Feedback
"3. QUEUE & OPERATIONS MODULE" --> Queue
"3. QUEUE & OPERATIONS MODULE" --> Appointment
"3. QUEUE & OPERATIONS MODULE" --> Dentist
"3. QUEUE & OPERATIONS MODULE" --> Room
"4. STAFF/OPERATIONS MODULE" --> Appointment
"4. STAFF/OPERATIONS MODULE" --> Dentist
"4. STAFF/OPERATIONS MODULE" --> Service
"4. STAFF/OPERATIONS MODULE" --> Room
"4. STAFF/OPERATIONS MODULE" --> OperatingHour

' ============================================
' CROSS-CUTTING SERVICE DEPENDENCIES
' ============================================

"2. PATIENT FUNCTIONAL MODULE" -.-> ActivityLogger : logs actions
"2. PATIENT FUNCTIONAL MODULE" -.-> WhatsAppSender : sends notifications
"3. QUEUE & OPERATIONS MODULE" -.-> ActivityLogger : logs assignments
"4. STAFF/OPERATIONS MODULE" -.-> ActivityLogger : logs management
"4. STAFF/OPERATIONS MODULE" -.-> RoleMiddleware : validates access

' ============================================
' DATABASE PERSISTENCE
' ============================================

Appointment --> DB
Queue --> DB
Dentist --> DB
DentistSchedule --> DB
DentistLeave --> DB
Service --> DB
Room --> DB
OperatingHour --> DB
Feedback --> DB
ActivityLog --> DB

' ============================================
' EXTERNAL SYSTEM CONNECTIONS
' ============================================

WhatsAppSender --> "Email Service\n(SMTP/Mailgun/SES)"
WhatsAppSender --> "SMS/WhatsApp Provider\n(Twilio/AWS SNS)"

@enduml
