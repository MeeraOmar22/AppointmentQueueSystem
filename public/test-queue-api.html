<!DOCTYPE html>
<html>
<head>
    <title>Queue Board Debug</title>
</head>
<body style="font-family: monospace; background: #f5f5f5; padding: 20px;">
    <h1>Queue Board API Test</h1>
    <div id="output" style="background: white; padding: 20px; border-radius: 8px; white-space: pre; overflow-x: auto;"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(msg) {
            output.textContent += msg + '\n';
            console.log(msg);
        }

        log('ðŸ§ª Testing Queue Board API...\n');
        
        // Test 1: Fetch API endpoint
        log('Test 1: Fetching /api/queue-board/data');
        fetch('/api/queue-board/data', {
            method: 'GET',
            headers: {
                'Cache-Control': 'no-cache, no-store, must-revalidate',
                'Accept': 'application/json'
            },
            cache: 'no-store'
        })
        .then(response => {
            log(`  Response Status: ${response.status} ${response.statusText}`);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            log('  âœ“ JSON parsed successfully');
            log(`  In Service: ${data.inService?.length || 0} patients`);
            log(`  Waiting: ${data.waiting?.length || 0} patients`);
            
            if (data.inService && data.inService.length > 0) {
                const patient = data.inService[0];
                log(`\n  Current Patient: ${patient.appointment?.patient_name || 'Unknown'}`);
                log(`  Queue Number: ${patient.queue_number}`);
                log(`  Room: ${patient.room?.room_number || 'NULL'}`);
                log(`  Dentist: ${patient.dentist?.name || 'NULL'}`);
            }
        })
        .catch(error => {
            log(`  âœ— ERROR: ${error.message}`);
            log(`  Stack: ${error.stack}`);
        });

        // Test 2: Check if queue-board page can load
        log('\n\nTest 2: Fetching /queue-board page');
        fetch('/queue-board', {
            method: 'GET',
            cache: 'no-store'
        })
        .then(response => {
            log(`  Response Status: ${response.status} ${response.statusText}`);
            if (response.ok) {
                log('  âœ“ Queue board page loads successfully');
            } else {
                throw new Error(`HTTP ${response.status}`);
            }
        })
        .catch(error => {
            log(`  âœ— ERROR: ${error.message}`);
        });
    </script>
</body>
</html>
