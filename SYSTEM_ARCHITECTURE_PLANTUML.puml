@startuml Dental_Clinic_System_Architecture
!theme plain
skinparam backgroundColor #fafafa
skinparam componentStyle uml2
skinparam linetype ortho
skinparam shadowing true

title Dental Clinic Appointment & Queue System\nFunctional Decomposition Diagram

' ============================================
' EXTERNAL ACTORS
' ============================================

actor "Patient" as patient
actor "Clinic Staff" as staff
actor "System Admin" as admin

' ============================================
' MODULE 1: PUBLIC/WEBSITE MODULE
' ============================================

package "PUBLIC/WEBSITE MODULE" #FFE4B5 {
    component "PublicController" as PublicController {
        port "home()" as home_port
        port "about()" as about_port
        port "services()" as services_port
        port "dentists()" as dentists_port
        port "contact()" as contact_port
        port "hours()" as hours_port
    }
    
    component "Views" as PublicViews {
        port "home.blade.php" as home_view
        port "about.blade.php" as about_view
        port "services.blade.php" as services_view
        port "dentists.blade.php" as dentists_view
        port "contact.blade.php" as contact_view
        port "hours.blade.php" as hours_view
    }
    
    PublicController --> PublicViews : renders
}

' ============================================
' MODULE 2: PATIENT FUNCTIONAL MODULE
' ============================================

package "PATIENT FUNCTIONAL MODULE" #E6F2FF {
    component "AppointmentController" as AppointmentController {
        port "create()" as apt_create_port
        port "store()" as apt_store_port
        port "visitStatus()" as apt_visit_port
        port "trackByCode()" as apt_track_port
        port "publicCheckIn()" as apt_checkin_port
        port "checkinForm()" as apt_form_port
        port "queueBoard()" as apt_queue_port
        port "findMyBooking()" as apt_find_port
    }
    
    component "FeedbackController" as FeedbackController {
        port "create()" as fb_create_port
        port "store()" as fb_store_port
        port "thanks()" as fb_thanks_port
    }
    
    component "ChatbotController" as ChatbotController {
        port "index()" as chat_index_port
        port "handle()" as chat_handle_port
    }
    
    component "Views" as PatientViews {
        port "book.blade.php" as book_view
        port "checkin.blade.php" as checkin_view
        port "track.blade.php" as track_view
        port "queue-board.blade.php" as qboard_view
        port "feedback.blade.php" as fb_view
        port "chat/index.blade.php" as chat_view
    }
    
    AppointmentController --> PatientViews : renders
    FeedbackController --> PatientViews : renders
    ChatbotController --> PatientViews : renders
}

' ============================================
' MODULE 3: QUEUE & OPERATIONS MODULE
' ============================================

package "QUEUE & OPERATIONS MODULE\n(Core Optimization Engine)" #E6FFE6 {
    component "QueueController (API)" as QueueController {
        port "checkIn()" as q_checkin_port
        port "getNextPatient()" as q_next_port
        port "updateQueueStatus()" as q_status_port
        port "getQueueStats()" as q_stats_port
        port "autoMarkLate()" as q_late_port
        port "autoMarkNoShow()" as q_noshow_port
    }
    
    component "CheckInService" as CheckInService {
        port "checkIn()" as cs_checkin_port
        port "validateCheckIn()" as cs_validate_port
        port "isLate()" as cs_islate_port
        port "checkInLate()" as cs_late_port
    }
    
    component "QueueAssignmentService" as QueueAssignment {
        port "assignNextPatient()" as qa_assign_port
        port "startTreatment()" as qa_start_port
        port "completeTreatment()" as qa_complete_port
        port "getEstimatedWaitTime()" as qa_wait_port
        port "getQueueStats()" as qa_stats_port
        port "findAvailableRoom()" as qa_room_port
        port "findAvailableDentist()" as qa_dentist_port
    }
    
    component "LateNoShowService" as LateNoShowService {
        port "markLateAppointments()" as lns_late_port
        port "markNoShowAppointments()" as lns_noshow_port
        port "handleDentistUnavailable()" as lns_handle_port
    }
    
    QueueController --> CheckInService : uses
    QueueController --> QueueAssignment : uses
    QueueController --> LateNoShowService : uses
    CheckInService --> QueueAssignment : calls
}

' ============================================
' MODULE 4: STAFF/OPERATIONS MODULE
' ============================================

package "STAFF/OPERATIONS MODULE" #FFF0E6 {
    component "AppointmentController\n(Staff)" as StaffAppointmentController {
        port "index()" as staff_apt_list_port
        port "create()" as staff_apt_create_port
        port "store()" as staff_apt_store_port
        port "edit()" as staff_apt_edit_port
        port "update()" as staff_apt_update_port
        port "destroy()" as staff_apt_destroy_port
    }
    
    component "DentistController" as DentistController {
        port "index()" as dentist_list_port
        port "create()" as dentist_create_port
        port "store()" as dentist_store_port
        port "edit()" as dentist_edit_port
        port "update()" as dentist_update_port
        port "destroy()" as dentist_destroy_port
    }
    
    component "ServiceController" as ServiceController {
        port "index()" as service_list_port
        port "create()" as service_create_port
        port "store()" as service_store_port
    }
    
    component "RoomController" as RoomController {
        port "index()" as room_list_port
        port "create()" as room_create_port
        port "store()" as room_store_port
    }
    
    component "OperatingHourController" as OperatingHourController {
        port "index()" as hour_list_port
        port "create()" as hour_create_port
        port "store()" as hour_store_port
    }
    
    component "DentistScheduleController" as ScheduleController {
        port "index()" as schedule_list_port
        port "update()" as schedule_update_port
        port "calendar()" as schedule_calendar_port
    }
    
    component "DentistLeaveController" as LeaveController {
        port "store()" as leave_create_port
        port "destroy()" as leave_delete_port
    }
    
    component "CalendarController" as CalendarController {
        port "index()" as cal_index_port
        port "events()" as cal_events_port
    }
    
    component "QuickEditController" as QuickEditController {
        port "index()" as quick_dashboard_port
        port "updateDentistStatus()" as quick_dentist_port
        port "updateServiceStatus()" as quick_service_port
        port "updateOperatingHour()" as quick_hour_port
    }
    
    component "PastController" as PastController {
        port "index()" as past_index_port
        port "restoreDentist()" as past_restore_port
        port "forceDeleteDentist()" as past_force_port
    }
    
    component "ActivityLogController" as ActivityLogController {
        port "index()" as actlog_index_port
    }
    
    component "FeedbackController\n(Staff)" as StaffFeedbackController {
        port "index()" as staff_fb_list_port
        port "show()" as staff_fb_show_port
    }
    
    component "Views" as StaffViews {
        port "appointments.blade.php" as staff_apt_view
        port "dentists/*.blade.php" as dentist_view
        port "services/*.blade.php" as service_view
        port "rooms/*.blade.php" as room_view
        port "calendar/*.blade.php" as calendar_view
        port "activity-logs.blade.php" as actlog_view
        port "quick-edit.blade.php" as quick_view
    }
    
    StaffAppointmentController --> StaffViews : renders
    DentistController --> StaffViews : renders
    ServiceController --> StaffViews : renders
    RoomController --> StaffViews : renders
    CalendarController --> StaffViews : renders
    QuickEditController --> StaffViews : renders
}

' ============================================
' MODULE 5: ADMIN MODULE
' ============================================

package "ADMIN MODULE" #F0E6FF {
    component "HomeController" as HomeController {
        port "index()" as home_dashboard_port
    }
    
    component "DeveloperController" as DeveloperController {
        port "login()" as dev_login_port
        port "dashboard()" as dev_dashboard_port
        port "apiTest()" as dev_apitest_port
    }
    
    component "PastController\n(Admin)" as AdminPastController {
        port "index()" as admin_past_port
        port "restore()" as admin_restore_port
        port "forceDelete()" as admin_force_port
    }
    
    component "Views" as AdminViews {
        port "home.blade.php" as admin_home_view
        port "developer/*.blade.php" as dev_view
        port "past.blade.php" as past_view
    }
    
    HomeController --> AdminViews : renders
    DeveloperController --> AdminViews : renders
    AdminPastController --> AdminViews : renders
}

' ============================================
' CROSS-CUTTING SERVICES
' ============================================

package "CROSS-CUTTING SERVICES" #F5F5F5 {
    component "ActivityLogger" as ActivityLogger {
        port "log()" as log_port
    }
    
    component "WhatsAppSender" as WhatsAppSender {
        port "sendAppointmentConfirmation()" as whatsapp_port
    }
    
    component "RoleMiddleware" as RoleMiddleware {
        port "handle()" as role_port
    }
    
    component "Authentication" as Auth {
        port "login()" as auth_login_port
        port "register()" as auth_register_port
        port "logout()" as auth_logout_port
    }
}

' ============================================
' DATA LAYER
' ============================================

package "DATA LAYER - MODELS" #E8E8E8 {
    component "Appointment" as AptModel
    component "Queue" as QueueModel
    component "Dentist" as DentistModel
    component "DentistSchedule" as ScheduleModel
    component "DentistLeave" as LeaveModel
    component "Service" as ServiceModel
    component "Room" as RoomModel
    component "OperatingHour" as HourModel
    component "User" as UserModel
    component "Feedback" as FeedbackModel
    component "ActivityLog" as LogModel
}

' ============================================
' DATABASE
' ============================================

database "Database\n(SQLite/MySQL)" as DB {
    table "appointments" as apt_table
    table "queues" as q_table
    table "dentists" as dentist_table
    table "dentist_schedules" as schedule_table
    table "dentist_leaves" as leave_table
    table "services" as service_table
    table "rooms" as room_table
    table "operating_hours" as hour_table
    table "users" as user_table
    table "feedback" as fb_table
    table "activity_logs" as log_table
}

' ============================================
' EXTERNAL SYSTEMS
' ============================================

package "EXTERNAL SYSTEMS" #FFE8E8 {
    component "Email Service\n(SMTP/Mailgun)" as EmailService
    component "SMS/WhatsApp\nProvider" as SMSService
    component "Queue Worker\n(Database)" as QueueWorker
}

' ============================================
' RELATIONSHIPS & FLOWS
' ============================================

' Public Website Module
patient --> home_port : visits
patient --> services_port : browses
patient --> dentists_port : views

' Patient Functional Module
patient --> apt_create_port : books appointment
patient --> apt_checkin_port : checks in
patient --> apt_visit_port : tracks status
patient --> apt_queue_port : views queue
patient --> fb_create_port : submits feedback
patient --> chat_index_port : chats

' Queue & Operations Module
AppointmentController --> q_checkin_port : submits check-in
AppointmentController --> q_next_port : requests next patient
StaffAppointmentController --> q_checkin_port : processes check-in
QueueAssignment --> CheckInService : coordinates
QueueAssignment --> ActivityLogger : logs actions

' Staff Operations Module
staff --> staff_apt_list_port : views appointments
staff --> dentist_list_port : manages dentists
staff --> service_list_port : manages services
staff --> room_list_port : manages rooms
staff --> quick_dashboard_port : quick edits
staff --> actlog_index_port : views audit logs

' Admin Module
admin --> dev_dashboard_port : admin dashboard
admin --> admin_past_port : manages deleted records

' Service Dependencies
AppointmentController --> CheckInService : uses
StaffAppointmentController --> CheckInService : uses
CheckInService --> AptModel : queries/updates
QueueAssignment --> QueueModel : manages
QueueAssignment --> RoomModel : allocates
QueueAssignment --> DentistModel : allocates

' Cross-cutting Services
AppointmentController --> ActivityLogger : logs booking
StaffAppointmentController --> ActivityLogger : logs actions
QueueAssignment --> ActivityLogger : logs assignments
LateNoShowService --> ActivityLogger : logs status changes
AppointmentController --> WhatsAppSender : sends confirmation
StaffAppointmentController -.-> RoleMiddleware : checks role
staff -.-> Auth : authenticates

' Models to Database
AptModel --> apt_table
QueueModel --> q_table
DentistModel --> dentist_table
ScheduleModel --> schedule_table
LeaveModel --> leave_table
ServiceModel --> service_table
RoomModel --> room_table
HourModel --> hour_table
UserModel --> user_table
FeedbackModel --> fb_table
LogModel --> log_table

' External Systems
WhatsAppSender --> EmailService : sends emails
WhatsAppSender --> SMSService : sends messages
QueueAssignment --> QueueWorker : background job

' Relationships from modules to models
PatientViews -.-> AptModel : binds data
PatientViews -.-> FeedbackModel : binds data
StaffViews -.-> AptModel : displays
StaffViews -.-> DentistModel : displays
StaffViews -.-> ServiceModel : displays
StaffViews -.-> RoomModel : displays

@enduml
